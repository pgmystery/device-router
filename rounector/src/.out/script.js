frameSites[1]="device_finder",frameFunctions.device_finder=(()=>{}),loadFrame("device_finder");const device_finder_comboBox_device_name=document.getElementById("device_finder_device"),device_finder_comboBox_device_version=document.getElementById("device_finder_device_version");async function getDevices(){return await fetch(rounector.url+"/api/device/type").then(async e=>await e.json())}let device_finder_devices;getDevices().then(e=>{device_finder_devices=e,e.forEach(e=>addOptionItem(device_finder_comboBox_device_name,e.name))});const device_finder_form=document.getElementById("device_finder_form");function device_select_clear(e){e.innerHTML="",addOptionItem(e,"Choose automatically..."),e.disabled=!0}function addOptionItem(e,t){const n=document.createElement("option");n.text=t,e.add(n)}async function device_finder_start(){const e=device_finder_comboBox_device_name.selectedIndex,t=device_finder_comboBox_device_version.selectedIndex;if(0===e)return rounector.data.device_type=device_finder_devices,!0;{rounector.data.device_type=device_finder_comboBox_device_name.options[device_finder_comboBox_device_name.selectedIndex].text;const e=device_finder_devices.find(e=>e.name===device_finder_comboBox_device_name.options[device_finder_comboBox_device_name.selectedIndex].text);if(0===t)return rounector.data.device_version=e.version,!0;{const t=device_finder_comboBox_device_version.options[device_finder_comboBox_device_version.selectedIndex].text.replace(/\./g,"_");return rounector.data.device_version={[t]:e.version[t]},!0}}}function start_connect(){const e=new FormData(document.querySelector("form")),t={},n=e.get("ip_type");rounector.data.ssh_method=n,"ipv4"===n?rounector.data.ssh_ip=e.get("ssh_ipv4"):"ipv6"===n&&(rounector.data.ssh_ip=e.get("ssh_ipv6")),t.host=rounector.data.ssh_ip,rounector.data.ssh_port=e.get("ssh_port"),rounector.data.ssh_username=e.get("ssh_username"),t.port=rounector.data.ssh_port,t.username=rounector.data.ssh_username;const o=e.get("password_type");rounector.data.ssh_password=e.get("ssh_password"),"password"===o?(rounector.data.ssh_private_key="",t.password=rounector.data.ssh_password):"pkey"===o&&(rounector.data.ssh_private_key=e.get("key_path"),t.privateKey=rounector.data.ssh_private_key,t.passphrase=rounector.data.ssh_password),check_device(t)}function check_device(e){for(const[e,t]of Object.entries(rounector.data.device_type))for(const[n,o]of Object.entries(t))for(const[t,d]of Object.entries(o))if(check_connection(d))return[e,n,t]}async function check_connection(e){try{rounector.data.ssh_private_key||await rounector.connect(loginData,e).then(e=>{console.log("RESULT BEGIN"),console.log(e),console.log("RESULT END"),check_device(e)})}catch(e){console.log(e)}}device_finder_form.addEventListener("submit",e=>{e.preventDefault(),device_finder_start().then(e=>{e&&loadFrameNext()}).catch(e=>{console.log("ERROR"),console.log(e)})}),document.getElementById("device_finder_back").addEventListener("click",()=>{loadFrameBack()}),device_finder_comboBox_device_name.addEventListener("change",()=>{if(device_select_clear(device_finder_comboBox_device_version),device_finder_comboBox_device_name.selectedIndex>0){const e=device_finder_devices.find(e=>e.name===device_finder_comboBox_device_name.options[device_finder_comboBox_device_name.selectedIndex].text);Object.keys(e.version).forEach(e=>addOptionItem(device_finder_comboBox_device_version,e.replace(/_/g,"."))),device_finder_comboBox_device_version.options.length>1&&(device_finder_comboBox_device_version.disabled=!1)}}),document.getElementById("headerText").textContent="Rounector v"+appVersion.toUpperCase().replace("-"," "),document.getElementById("exit").addEventListener("click",e=>{e.preventDefault(),closeApp()}),frameSites[0]="register_token",frameFunctions.register_token=(()=>{}),loadFrame("register_token"),setActiveFrame("register_token"),document.getElementById("register_token_form").addEventListener("submit",e=>{e.preventDefault();const t=new FormData(document.getElementById("register_token_form"));register_token_data=Object.fromEntries(t),rounector.data={...rounector.data,...register_token_data},loadFrameNext()}),frameSites[2]="ssh_connect",frameFunctions.ssh_connect=(()=>{}),loadFrame("ssh_connect"),document.getElementById("ssh_connect_back").addEventListener("click",()=>{loadFrameBack()}),document.getElementById("ipv4_radio").addEventListener("change",()=>{const e=document.getElementById("ssh_ipv4_address"),t=document.getElementById("ssh_ipv6_address");t.hidden=!0,e.hidden=!1,e.required=!0,t.required=!1,e.focus()}),document.getElementById("ipv6_radio").addEventListener("change",()=>{const e=document.getElementById("ssh_ipv4_address"),t=document.getElementById("ssh_ipv6_address");e.hidden=!0,t.hidden=!1,t.required=!0,e.required=!1,t.focus()}),document.getElementById("password_radio").addEventListener("change",()=>{const e=document.getElementById("ssh_password");document.getElementById("ssh_key_path").required=!1,document.getElementById("ssh_key").classList.add("hidden"),e.placeholder="SSH-Password",e.focus()}),document.getElementById("pkey_radio").addEventListener("change",()=>{const e=document.getElementById("ssh_key_path");e.required=!0,document.getElementById("ssh_key").classList.remove("hidden"),document.getElementById("ssh_password").placeholder="Private-Key password",e.focus()}),document.getElementById("ssh_key_path_button").addEventListener("click",()=>{dialog.showOpenDialog({properties:["openFile"]},e=>{e&&(document.getElementById("ssh_key_path").value=e[0])})}),document.getElementById("ssh_connect_form").addEventListener("submit",e=>{e.preventDefault(),start_connect()});